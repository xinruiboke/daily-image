<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bing - 每日一图</title>
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="https://cdn.xrbk.cn/fonts/LXGWWenKaiScreen/result.css">
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family: "LXGW WenKai Screen";
        line-height: 1.6;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        color: #333;
        background-color: #ffffff;
      }
      
      /* 全宽导航栏 */
      .navbar {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        backdrop-filter: blur(10px);
        z-index: 1000;
        padding: 10px 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        background: rgba(255, 255, 255, 0.9);
      }
      
      .navbar-item {
        color: #333;
      }
      
      .navbar-item:hover {
        color: #000;
      }
      
      .navbar-item::after {
        background-color: #000;
      }
      
      .menu-toggle {
        color: #333;
      }
      
      .card {
        background: #fff;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        will-change: transform, opacity; /* 优化动画性能 */
      }
      
      .card:hover {
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
      }
      
      .date-label {
        background: rgba(255, 255, 255, 0.9);
        color: #333;
        border: 1px solid rgba(0, 0, 0, 0.1);
      }
      
      .copy-text {
        background: linear-gradient(to top, rgba(255, 255, 255, 0.95), transparent);
        color: #333;
      }
      
      .modal {
        background: rgba(255, 255, 255, 0.95);
      }
      
      .modal-caption {
        background: linear-gradient(to top, rgba(255, 255, 255, 0.95), transparent);
        color: #333;
      }
      
      .modal-close {
        color: #333;
      }
      
      footer {
        background: #f5f5f5;
        color: #666;
        border-top: 1px solid rgba(0, 0, 0, 0.1);
      }
      
      footer a {
        color: #333;
      }
      
      footer a:hover {
        color: #000;
      }
      
      footer a::after {
        background-color: #000;
      }
      
      .yiyan {
        background: #f5f5f5;
        color: #333;
        border-top: 1px solid rgba(0, 0, 0, 0.1);
      }
      
      .yiyan-content::before,
      .yiyan-content::after {
        border-color: rgba(0, 0, 0, 0.2);
      }
      
      .history-container {
        background: #f5f5f5;
      }
      
      /* 导航栏居中布局 */
      .navbar-content {
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        justify-content: center; /* 改为居中 */
        align-items: center;
        position: relative; /* 为绝对定位的子元素提供参考 */
      }
      
      .navbar-logo {
        display: flex;
        align-items: center;
        gap: 10px;
        position: absolute; /* 绝对定位在左侧 */
        left: 0;
      }
      
      .navbar-logo img {
        width: 24px;
        height: 24px;
        border-radius: 50%;
      }
      
      .navbar-menu {
        display: flex;
        gap: 20px;
      }
      
      .navbar-item {
        text-decoration: none;
        padding: 5px 10px;
        position: relative;
        transition: color 0.3s ease;
      }
      
      .navbar-item:hover {
        color: #000;
      }
      
      .navbar-item::after {
        content: '';
        position: absolute;
        width: 0;
        height: 2px;
        bottom: 0;
        left: 10px;
        transition: width 0.3s ease;
      }
      
      .navbar-item:hover::after {
        width: calc(100% - 20px);
      }
      
      .menu-toggle {
        display: none;
        font-size: 1.5rem;
        cursor: pointer;
        position: absolute; /* 绝对定位在右侧 */
        right: 0;
      }
      
      @media (max-width: 768px) {
        .navbar-menu {
          display: none;
          flex-direction: column;
          position: absolute;
          top: 100%;
          left: 0;
          width: 100%;
          padding: 10px 20px;
          background: rgba(255, 255, 255, 0.95);
        }
        
        .navbar-menu.active {
          display: flex;
        }
        
        .menu-toggle {
          display: block;
        }
        
        .navbar-logo {
          position: static; /* 移动端恢复静态定位 */
          margin-right: auto; /* 左侧对齐 */
        }
        
        .navbar-content {
          justify-content: space-between; /* 移动端左右分布 */
        }
      }

      /* Hero Section */
      .hero {
        position: relative;
        width: 100%;
        height: 80vh;
        overflow: hidden;
        padding-top: 60px;
        background: #ffffff;
      }
      
      .hero-img-container {
        width: 100%;
        height: 100%;
        position: relative;
        overflow: hidden;
      }
      
      .hero-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
        opacity: 0;
      }
      
      .hero-img.loaded {
        opacity: 1;
      }
      
      .hero-img-loading {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #ffffff;
        transition: opacity 0.3s ease;
      }
      
      .hero-img-loading-spinner {
        width: 50px;
        height: 50px;
        border: 4px solid rgba(0, 0, 0, 0.1);
        border-radius: 50%;
        border-top-color: #4a6cf7;
        animation: spin 1s ease-in-out infinite;
      }
      
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
      
      .hero:hover .hero-img {
        transform: scale(1.02);
      }
      
      .hero .overlay {
        position: absolute;
        top: 60px;
        left: 0;
        width: 100%;
        height: calc(100% - 60px);
        background: linear-gradient(
          to top,
          rgba(0, 0, 0, 0.7),
          transparent 40%
        );
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
        padding: 40px;
        color: #fff;
      }
      
      .hero .center-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        width: 100%;
      }
      
      .hero .center-text h1 {
        font-size: 3rem;
        font-weight: 300;
        margin-bottom: 15px;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.8);
      }
      
      .hero .center-text p {
        font-size: 1.2rem;
        max-width: 600px;
        margin: 0 auto;
        text-shadow: 0 2px 6px rgba(0, 0, 0, 0.8);
      }
      
      .hero .overlay .date {
        font-size: 2rem;
        margin-bottom: 10px;
        font-weight: 300;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
      }
      
      .hero .overlay .copy {
        font-size: 1.2rem;
        max-width: 1000px;
        font-weight: 300;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
      }

      /* 一言样式 */
      .yiyan {
        padding: 40px 0 20px 0;
        text-align: center;
        font-size: 1.2rem;
        line-height: 1.8;
        border-top: 1px solid rgba(0, 0, 0, 0.1);
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        position: relative;
      }
      
      .yiyan-content {
        max-width: 800px;
        margin: 0 auto;
        font-weight: 300;
        position: relative;
        padding: 20px 20px;
        margin: 0 20px;
      }

      /* 添加左上角和右下角的直角装饰 */
      .yiyan-content::before,
      .yiyan-content::after {
        content: '';
        position: absolute;
        width: 20px;
        height: 20px;
        border-style: solid;
        border-color: rgba(0, 0, 0, 0.2);
      }

      .yiyan-content::before {
        top: 0;
        left: 0;
        border-width: 2px 0 0 2px;
      }

      .yiyan-content::after {
        bottom: 0;
        right: 0;
        border-width: 0 2px 2px 0;
      }
      
      .yiyan-loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 2px solid rgba(0, 0, 0, 0.2);
        border-radius: 50%;
        border-top-color: #333;
        animation: spin 1s ease-in-out infinite;
      }

      /* History Grid */
      .history-container {
        padding: 40px 20px;
        flex: 1;
      }
      
      .history {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
        margin: 0 auto;
        max-width: 1200px;
      }

      @media (max-width: 1200px) {
        .history {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      @media (max-width: 768px) {
        .history {
          grid-template-columns: 1fr;
        }
      }

      /* 卡片样式 */
      .card {
        position: relative;
        border-radius: 8px;
        overflow: hidden;
        transition: all 0.3s ease;
        cursor: pointer;
        aspect-ratio: 16/9;
        will-change: transform, opacity; /* 优化动画性能 */
      }
      
      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
      }
      
      .card-img-container {
        position: relative;
        width: 100%;
        height: 100%;
      }
      
      .card-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
        opacity: 0;
      }
      
      .card-img.loaded {
        opacity: 1;
      }
      
      .card-img-loading {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #ffffff;
        transition: opacity 0.3s ease;
      }
      
      .card-img-spinner {
        width: 30px;
        height: 30px;
        border: 3px solid rgba(0, 0, 0, 0.1);
        border-radius: 50%;
        border-top-color: #4a6cf7;
        animation: spin 1s ease-in-out infinite;
      }
      
      .card:hover .card-img {
        transform: scale(1.05);
      }
      
      .card .date-label {
        position: absolute;
        bottom: 15px;
        left: 15px;
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 0.8rem;
        transition: all 0.3s ease;
      }
      
      .card .copy-text {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        padding: 15px;
        font-size: 0.9rem;
        text-align: center;
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.3s ease;
      }
      
      .card:hover .date-label {
        opacity: 0;
        transform: translateY(10px);
      }
      
      .card:hover .copy-text {
        opacity: 1;
        transform: translateY(0);
      }

      /* 更新后的Modal样式 */
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        backdrop-filter: blur(10px);
        z-index: 1000;
        display: none;
        align-items: center;
        justify-content: center;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
        background: rgba(255, 255, 255, 0);
      }

      .modal.active {
        opacity: 1;
        visibility: visible;
        background: rgba(255, 255, 255, 0.95);
      }

      .modal-content {
        max-width: 90%;
        max-height: 90%;
        transform: scale(0.95);
        transition: transform 0.3s ease, opacity 0.3s ease;
        opacity: 0;
      }

      .modal.active .modal-content {
        transform: scale(1);
        opacity: 1;
      }

      .modal-img-container {
        position: relative;
        max-width: 100%;
        max-height: 80vh;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      }

      .modal-img {
        max-width: 100%;
        max-height: 80vh;
        object-fit: contain;
        display: block;
      }

      .modal-caption {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        padding: 30px 20px 20px;
        text-align: center;
        transform: translateY(100%);
        opacity: 0;
        transition: all 0.3s ease;
        background: linear-gradient(to top, rgba(255, 255, 255, 0.95), transparent);
        color: #333;
      }

      .modal-img-container:hover .modal-caption {
        transform: translateY(0);
        opacity: 1;
      }

      .modal-close {
        position: absolute;
        top: 30px;
        right: 30px;
        font-size: 2rem;
        cursor: pointer;
        background: none;
        border: none;
        transition: transform 0.3s ease;
        opacity: 0.7;
        color: #333;
      }

      .modal-close:hover {
        transform: rotate(90deg);
        opacity: 1;
      }

      /* 页脚样式 */
      footer {
        padding: 20px 15px;
        text-align: center;
        font-size: 0.9rem;
        border-top: 1px solid rgba(0, 0, 0, 0.1);
      }
      
      footer a {
        text-decoration: none;
        transition: color 0.2s ease;
        position: relative;
      }
      
      footer a:hover {
        color: #000;
      }
      
      footer a::after {
        content: '';
        position: absolute;
        width: 0;
        height: 1px;
        bottom: -2px;
        left: 0;
        transition: width 0.3s ease;
        background-color: #000;
      }
      
      footer a:hover::after {
        width: 100%;
      }
      
      .footer-info {
        margin-bottom: 10px;
      }
      
      .footer-copyright {
        font-size: 0.8rem;
      }
    </style>
  </head>
  <body>
    <!-- 全宽导航栏 -->
    <nav class="navbar">
      <div class="navbar-content">
        <div class="navbar-logo">
          <img src="bing.ico" alt="Icon" loading="lazy" />
          <span>Bing每日一图</span>
        </div>
        <div class="navbar-menu" id="navbarMenu">
          <a href="https://www.xrbk.cn" class="navbar-item" target="_blank">博客</a>
          <a href="https://cdn.xrbk.cn" class="navbar-item" target="_blank">公共CDN</a>
          <a href="https://www.xrbk.cn/dsjz" class="navbar-item" target="_blank">打赏捐赠</a>
        </div>
        <div class="menu-toggle" id="menuToggle">
          <i>&equiv;</i>
        </div>
      </div>
    </nav>

    <div class="hero">
      <div class="hero-img-container">
        <div class="hero-img-loading">
          <div class="hero-img-loading-spinner"></div>
        </div>
        <img
          id="hero-img" 
          class="hero-img" 
          alt="Today's Bing Wallpaper"
          loading="eager"  <!-- 优先加载首屏图片 -->
        />
      </div>
      <div class="overlay">
        <div class="center-text">
          <h1>Bing每日一图</h1>
          <p>实现每日一图接口，保存最近30天内的bing壁纸</p>
          <p>由新锐博客进行维护，每日更新，每日精彩</p>
        </div>
        <div class="date" id="hero-date"></div>
        <div class="copy" id="hero-copy"></div>
      </div>
    </div>

    <div class="yiyan">
      <div class="yiyan-content">
        <span class="yiyan-loading"></span>
      </div>
      <div class="yiyan-signature">----送给素不相识的陌生人----</div>
    </div>

    <div class="history-container">
      <div class="history" id="history"></div>
    </div>

    <!-- 页脚 -->
    <footer>
      <div class="footer-info">
      <script async src="https://cdn.jsdmirror.com/npm/penndu@16.0.0/bsz.js"></script>
总访问量 <span id="busuanzi_site_pv">加载中...</span> 次
总访客数 <span id="busuanzi_site_uv">加载中...</span> 人
      </div>
      <div class="footer-copyright">
 <span>本站已运行：<span id="running-days">计算中...</span> | © <span id="year"></span> 新锐博客 | <a rel="nofollow" target="_blank" href="https://beian.miit.gov.cn">苏ICP备2024091362号</a> | 本项目基于<a rel="nofollow" target="_blank" href="https://github.com/willow-god/daily-image" >Daily Bing Image</a>二次开发</span>
      </div>
    </footer>

    <!-- Modal -->
    <div class="modal" id="imageModal">
      <button class="modal-close" id="modalClose">&times;</button>
      <div class="modal-content">
        <div class="modal-img-container">
          <img class="modal-img" id="modalImage" src="" alt="" loading="lazy" />
          <div class="modal-caption" id="modalCaption"></div>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // 导航栏菜单切换
        const menuToggle = document.getElementById('menuToggle');
        const navbarMenu = document.getElementById('navbarMenu');
        
        menuToggle.addEventListener('click', () => {
          navbarMenu.classList.toggle('active');
        });
        
        // 点击菜单项后关闭菜单（移动端）
        const menuItems = navbarMenu.querySelectorAll('.navbar-item');
        menuItems.forEach(item => {
          item.addEventListener('click', () => {
            if (window.innerWidth < 768) {
              navbarMenu.classList.remove('active');
            }
          });
        });
        
        // 滚动时导航栏背景变化
        window.addEventListener('scroll', () => {
          const navbar = document.querySelector('.navbar');
          if (window.scrollY > 50) {
            navbar.classList.add('scrolled');
          } else {
            navbar.classList.remove('scrolled');
          }
        });

        // 动态年份显示
        document.getElementById("year").textContent = new Date().getFullYear();
        
        // 计算网站运行时间
        function updateTimes() {
          // 网站开始运行的日期（请修改为您的网站上线日期）
          const startDate = new Date('2025-6-29'); // 示例日期，请替换为实际上线日期
          const now = new Date();
          
          // 计算已运行天数
          const runningDays = Math.floor((now - startDate) / (1000 * 60 * 60 * 24));
          document.getElementById("running-days").textContent = runningDays + " 天";
        }
        
        // 初始更新
        updateTimes();
        
        // 每秒更新一次倒计时
        setInterval(updateTimes, 1000);

        // Modal elements
        const modal = document.getElementById("imageModal");
        const modalImage = document.getElementById("modalImage");
        const modalCaption = document.getElementById("modalCaption");
        const modalClose = document.getElementById("modalClose");

        function closeModal() {
          modal.classList.remove("active");
          setTimeout(() => {
            modal.style.display = "none";
          }, 300); // 匹配CSS过渡时间
        }

        function showModal() {
          modal.style.display = "flex";
          // 强制重绘，确保动画运行
          void modal.offsetWidth;
          modal.classList.add("active");
        }

        // Close modal when clicking the close button
        modalClose.addEventListener("click", closeModal);

        // Close modal when clicking outside the image
        modal.addEventListener("click", (e) => {
          if (e.target === modal) {
            closeModal();
          }
        });

        // Close modal with Escape key
        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape" && modal.classList.contains("active")) {
            closeModal();
          }
        });

        // 图片加载函数 - 直接加载所有图片
        function loadImage(imgElement, src) {
          // 确保加载动画元素存在
          const loadingElement = imgElement.previousElementSibling;
          
          // 创建Image对象预加载
          const loader = new Image();
          loader.src = src;
          loader.onload = () => {
            imgElement.src = src;
            imgElement.classList.add("loaded");
            
            // 隐藏加载动画
            if (loadingElement) {
              loadingElement.style.opacity = '0';
              setTimeout(() => {
                loadingElement.style.display = 'none';
              }, 300); // 等待淡出动画完成
            }
          };
          loader.onerror = () => {
            console.error("图片加载失败:", src);
            // 加载失败时也隐藏加载动画
            if (loadingElement) {
              loadingElement.style.display = 'none';
            }
          };
        }

        // 获取一言
        const yiyanContent = document.querySelector('.yiyan-content');
        
        fetch('https://v2.xxapi.cn/api/yiyan?type=hitokoto')
          .then(response => response.json())
          .then(data => {
            if (data.code === 200 && data.data) {
              // 创建淡入效果
              yiyanContent.innerHTML = `<span style="opacity: 0; transition: opacity 1s ease;">${data.data}</span>`;
              
              // 强制重绘后显示文字
              setTimeout(() => {
                const textSpan = yiyanContent.querySelector('span');
                if (textSpan) {
                  textSpan.style.opacity = '1';
                }
              }, 100);
            } else {
              yiyanContent.textContent = '生活，是一场无法回放的电影，我们都是自己的导演。';
            }
          })
          .catch(error => {
            console.error('获取一言失败:', error);
            yiyanContent.textContent = '生活，是一场无法回放的电影，我们都是自己的导演。';
          });

        fetch("/picture/index.json")
          .then((res) => res.json())
            .then((data) => {
            if (!Array.isArray(data) || data.length === 0) {
              console.error("index.json 内容不合法");
              return;
            }

            // 默认将第一张作为今日图
            const today = data[0];
            const heroImg = document.getElementById("hero-img");
            document.getElementById("hero-date").textContent = today.date;
            document.getElementById("hero-copy").textContent = today.copyright;
            loadImage(heroImg, today.path);

            // 其余为历史图
            const historyEl = document.getElementById("history");

            // 逐个添加卡片，带动画
            data.forEach((item, index) => {
              setTimeout(() => {
                const card = document.createElement("div");
                card.className = "card";
                card.style.opacity = "0";
                card.style.transform = "translateY(50px)";
                card.style.transition = "opacity 1.0s cubic-bezier(.4,2,.6,1), transform 1.0s cubic-bezier(.4,2,.6,1)";

                const imgContainer = document.createElement("div");
                imgContainer.className = "card-img-container";
                
                const loadingDiv = document.createElement("div");
                loadingDiv.className = "card-img-loading";
                loadingDiv.innerHTML = '<div class="card-img-spinner"></div>';
                
                const img = document.createElement("img");
                img.alt = item.date;
                img.className = "card-img";
                img.src = item.path; // 直接使用src而不是data-src
                
                const dateLabel = document.createElement("div");
                dateLabel.className = "date-label";
                dateLabel.textContent = item.date;

                const copyText = document.createElement("div");
                copyText.className = "copy-text";
                copyText.textContent = item.copyright;

                imgContainer.appendChild(loadingDiv);
                imgContainer.appendChild(img);
                card.appendChild(imgContainer);
                card.appendChild(dateLabel);
                card.appendChild(copyText);
                historyEl.appendChild(card);

                // 立即加载图片
                loadImage(img, item.path);

                // 添加点击事件显示modal
                card.addEventListener("click", () => {
                  modalImage.src = item.path;
                  modalCaption.textContent = `${item.date} - ${item.copyright}`;
                  showModal();
                });

                // 触发动画
                setTimeout(() => {
                  card.style.opacity = "1";
                  card.style.transform = "translateY(0)";
                }, 50);
              }, index * 80); // 每个卡片延迟80ms
            });
          })
          .catch((err) => console.error("加载 index.json 失败", err));
      });
    </script>
  </body>
</html>
